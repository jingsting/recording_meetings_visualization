<!doctype html>
<html>
<body>
        <h1>testing</h1>
          <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://unpkg.com/d3-simple-slider@0.2.1/build/d3-simple-slider.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.0.4/math.js"></script>
        <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
        <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
<script>
// var test_variable='';
// function loadJSON(){

//     var http_request = new XMLHttpRequest();
//     try{
//     http_request = new XMLHttpRequest();
//     }catch (e){
//     try{
//         http_request = new ActiveXObject("Msxml2.XMLHTTP");
//     }catch (e) {
//         try{
//             http_request = new ActiveXObject("Microsoft.XMLHTTP");
//         }catch (e){
//             alert("Your browser broke!");
//             return false;
//         }
//     }
//     }
//     d3.selectAll("svg").remove();
//     http_request.onreadystatechange = function(){
////===================================================================================

        /////////code here////////////

////===================================================================================
//         http_request.open("GET", "/js9");
//         http_request.send();
//     }
//     function startVis(){
//         var inter = setInterval(function() {
//         loadJSON();
//         }, 5000);
//     }
//     startVis();
// }

var numParticipants=5;
var max_times_spoken=0;
var circleData = [];
var alpha = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"];
// var all_texts="ads;kf hasdjhf ksadj;faj sd;lkfja;lsd jfalkdsjfa;lsdjf;la jds;flkajds f;lkasdj;lfja;lskdjf;lakjsd fajlkds fj;alsdjf ;asdjf;lksadjf;a ds"
var all_texts="what the words rectangle box functions multiple visions loading the whole integer and font and text word boxes parenthesis python snakes who"
//--------------------------------------------------creation of svg--------------------------------
var svgContainer = d3.select("body")
    .append("svg")
    .attr("width", 750)
    .attr("height", 750)
    .style("border", "1px solid black");
//-------------------------------------------------------------------------------------------------
var colors = d3.scaleLinear().domain([1,max_times_spoken+(max_times_spoken*0.06)])
    .interpolate(d3.interpolateHcl)
    .range([d3.rgb("#FFFFFF"), d3.color("#ff0000")]);
//-----------------------------------------------creates the circles-------------------------------
var all_angles=[];
//=====================
for(i = 0; i < numParticipants; i++) {// formula from here http://bl.ocks.org/bycoffe/3404776
    var x = 0;
    var x_1 = [];
    var y = 0;
    var y_1 = [];
    var angle = (i / numParticipants) * 2 * Math.PI;
    all_angles.push(angle)
    x = (80 * Math.cos(angle)) + (770/2);
    y = (80 * Math.sin(angle)) + (770/2);
    x_1.push( ((150+8) * Math.cos(angle)) + (770/2) );
    y_1.push( ((150+8) * Math.sin(angle)) + (770/2) );
    var circle = svgContainer.append("circle")
        .attr("cx", x)
        .attr("cy", y)
        .attr("r", 25)
        .attr("id", i)
        .style("stroke", "black")
        .style("fill",colors(0))
        .style("padding", 2)
        // .on("mouseover", function() {
        //     return tooltip.text("Times Spoken: " + 0 + " Total Time: "  + 0).style("visibility", "visible");
        // })
        // .on("mousemove", function() {
        //     return tooltip.style("top", (d3.event.pageY-10)+"px")
        //                 .style("left",(d3.event.pageX+10)+"px");
        // })
        // .on("mouseout", function() {
        //     return tooltip.style("visibility", "hidden");
        // });
    
    circleData.push(circle);
    var id = parseInt(circleData[i].attr("id"));
    var text = svgContainer.append("text")
        .attr("x", x)
        .attr("y", y + 6)
        .text(alpha[id])
        .attr("id",i.toString())
        .attr("font-family", "san-serif")
        .attr("font-size", "20px")
        .attr("fill", "black")
        .attr("text-anchor", "middle")
        // .on("mouseover", function() {
        //     return tooltip.text("Times Spoken: " + 0 + " Total Time: "  + 0).style("visibility", "visible");
        // })
        // .on("mousemove", function() {
        //     return tooltip.style("top", (d3.event.pageY-10)+"px")
        //                 .style("left",(d3.event.pageX+10)+"px");
        // })
        // .on("mouseout", function() {
        //     return tooltip.style("visibility", "hidden");
        // });
}
//---------------------------create dictionary of angles---------------------
var dict_angles=[];
for(var i=0;i<all_angles.length;i++){
    dict_angles.push({
        key: alpha[i],
        value: all_angles[i]
    });
}

console.log(dict_angles[0].value);
//-------------------------------------------creates rectangles and words--------------------------------------------------------------------------------
var imp_info = format_text(svgContainer, all_texts,dict_angles,4,80);
//-------------------------------------------------------------------------------------------------------------------------------------------------------
//------------------------------------------------------------can refine function more later-------------------------------------------------------------
function format_text(object,sentences,dictionary_of_angles,person,radius){
    var words = sentences.split(" ");
    if(Math.round(Math.sqrt(words.length)/2)>0){
        dimensions= Math.round(Math.sqrt(words.length)/2)}
    else{dimensions = 1}
    var containers=[];
    for(var i=0;i<words.length;i){
        var temp = "";
        var counter=0;
        while (counter<dimensions && i<words.length){
            if (temp.length!=0){
                temp+=" ";
            }
            temp+=words[i];
            i++;counter++;
        }
        containers.push(temp);
    }
    var longest_= 0
    var index = 0
    for(var k=0; k<containers.length; k++){
        if(containers[k].length>longest_){
            longest_=containers[k].length;
            index=k;
        }
    }
    object.append("text").attr("x",300).attr("y",300).attr("id","test_text").text(containers[index]);
    var pixel_length = d3.select("#test_text").node().getComputedTextLength();
    d3.select("#test_text").remove();
    var long_length=Math.sqrt(((30+15*(containers.length-1))**2)+((pixel_length+10))**2);
    var x=((radius+50+long_length/2) * Math.cos(dict_angles[person].value));
    var y=((radius+50+long_length/2) * Math.sin(dict_angles[person].value));
    for(var i=0; i<containers.length;i++){
        object.append("text").attr("x",(x+770/2)-(pixel_length)/2).attr("y",(y+770/2-(15*(containers.length-1))/2+i*15)).attr("id","text_box").text(containers[i]);
    }
    // return [containers,pixel_length];

    svgContainer.append("rect")
        .attr("x", ((radius+50+long_length/2) * Math.cos(dict_angles[person].value)) + (770/2)- ((pixel_length+10)/2))
        .attr("y", ((radius+50+long_length/2) * Math.sin(dict_angles[person].value)) + (770/2) -(30+15*(containers.length-1))/2)
        .attr("rx",10)
        .attr("ry",10)
        .attr("id","rect_box")
        .attr("width", pixel_length+10)
        .attr("height", 30+15*(containers.length-1))
        .attr("stroke","black")
        .attr("fill","none")
        .attr("id","rect_box")
        .attr("border", "1px solid black");
}
//---------------------------------------------------------------------takes and puts all the info in the correct variables---------------------------------------------------
function parsing_info(data,circle_data,dictionary_of_){

    last_speaker(data[data.length-1]);
}
//-----------------------------------------------------------------------------previous speaker--------------------------------------------------------------------------------
function last_speaker(/*takes in last object in json*/last_line, circledatas){
    var user_person=last_line.user; //refine it
    circledatas[user_person].style("stroke", "lightpink").style("stroke-width", "5px");
}
</script>
</body>
</html>